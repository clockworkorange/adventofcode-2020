package adventofcode

import spock.lang.Specification
import spock.lang.Unroll

import java.math.RoundingMode

class Day3Test extends Specification {

    void 'Day 3 - minimal pattern repeats'() {
        given:
        BigDecimal with = exampleInput.indexOf('\n')
        BigDecimal high = exampleInput.count('\n') + 1
        BigDecimal step = rightStep * downStep

        when:
        Integer result = (high/step).setScale(0, RoundingMode.UP)

        then:
        high == 11
        with == 11
        step == 3
        result == 4
    }

    void 'Day3 - build forest'() {
        given:
        Integer minimalPatternRepeats = 4
        String result = ''

        when:
        result = exampleInput.tokenize('\n').collect { String line ->
            line * minimalPatternRepeats + '\n'
        }.join()

        then:
        result.contains('..##.........##.........##.........##.......\n') // First line
        result.contains('.#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#\n') // Seventh line
        result.contains('.#..#...#.#.#..#...#.#.#..#...#.#.#..#...#.#') // Last line
    }


    void 'Day3 - count trees'() {
        given:
        Integer minimalPatternRepeats = 4
        String map = exampleInput.tokenize('\n').collect { String line ->
            line * minimalPatternRepeats + '\n'
        }.join()
        Integer position = 0
        Integer result = 0

        when:
        map.eachLine { line ->
            if (line.substring(position, position + 1) == '#') {
                result++
            }
            position = position + rightStep
        }

        then:
        result == 7
    }

    void 'Day3 - solution part one'() {
        given:
        BigDecimal high = exampleInput.count('\n') + 1
        BigDecimal step = 1 * 1

        Integer minimalPatternRepeats = (high/step).setScale(0, RoundingMode.UP) + 1

        String map = exampleInput.tokenize('\n').collect { String line ->
            line * minimalPatternRepeats + '\n'
        }.join()
        Integer position = 0
        Integer result = 0

        when:
        map.eachLine { line ->
            if (line.substring(position, position + 1) == '#') {
                result++
            }
            position = position + rightStep
        }

        then:
        result == 7
    }

    void 'Day3 - get down lines'() {
        given:
        Integer minimalPatternRepeats = 1
        Integer inputDown = 2
        String result = ''

        when:
        exampleInput.tokenize('\n').eachWithIndex { String line, int index ->
            if(index == 0) {
                result = result + line * minimalPatternRepeats + '\n'
            }
            else if(index % inputDown == 0) {
                result = result + line * minimalPatternRepeats + '\n'
            }
        }

        then:
        result == "..##.......\n" +
            ".#....#..#.\n" +
            ".#...##..#.\n" +
            ".#.#.#....#\n" +
            "#.##...#...\n" +
            ".#..#...#.#\n"
    }

    @Unroll
    void 'Day3 - solution part two'() {
        given:
        BigDecimal high = exampleInput.count('\n') + 1
        BigDecimal step = 1 * 1

        Integer minimalPatternRepeats = (high/step).setScale(0, RoundingMode.UP) + 1

        String map = ''
        exampleInput.tokenize('\n').eachWithIndex { String line, int index ->
            if(index == 0) {
                map = map + line * minimalPatternRepeats + '\n'
            }
            else if(index % inputDown == 0) {
                map = map + line * minimalPatternRepeats + '\n'
            }
        }
        Integer position = 0
        Integer result = 0

        when:
        map.eachLine { line ->
            if (line.substring(position, position + 1) == '#') {
                result++
            }
            position = position + inputRightStep
        }

        then:
        result == expected

        where:
        inputRightStep | inputDown | expected
        1              | 1         | 2
        3              | 1         | 7
        5              | 1         | 3
        7              | 1         | 4
        1              | 2         | 2
    }

    private static final String exampleInput = "..##.......\n" + //
        "#...#...#..\n" +
        ".#....#..#.\n" +//
        "..#.#...#.#\n" +
        ".#...##..#.\n" +//
        "..#.##.....\n" +
        ".#.#.#....#\n" +//
        ".#........#\n" +
        "#.##...#...\n" +//
        "#...##....#\n" +
        ".#..#...#.#"//

    private static final rightStep = 3

    private static final downStep = 1

    private static final input = "....#...#####..##.#..##..#....#\n" +
        "..##.#.#.........#.#......##...\n" +
        "#.#.#.##.##...#.......#...#..#.\n" +
        "..##.............#.#.##.....#..\n" +
        "##......#.............#....#...\n" +
        ".....##..#.....##.#.......##..#\n" +
        ".##.....#........##...##.#....#\n" +
        ".##......#.#......#.....#..##.#\n" +
        "##....#..#...#...#...##.#...##.\n" +
        "##........##.#...##......#.#.#.\n" +
        "..#.#........#...##.....#.....#\n" +
        "..#.......####.#....#..#####...\n" +
        ".##..#..#..##.#.....###.#..#...\n" +
        "......###..##.....#.#.#..###.#.\n" +
        "..#.#...#..##.....#....#.#.....\n" +
        ".....#.#...#.###.#..#..........\n" +
        "##.....#...#.#....#..#.#.......\n" +
        "..#...#...#.........##......#..\n" +
        "......#.#...#...#..#...##.#...#\n" +
        "....#.................##.##....\n" +
        "...#......#.............#....##\n" +
        "##..#..#..........#...##.#.#...\n" +
        "....#...##....#..#.#...........\n" +
        "##.#.#.#...#....#........#..#.#\n" +
        "...###..........#...#...#..##.#\n" +
        "..##.......###.#......##.##....\n" +
        "...........#.#....#.....#.#...#\n" +
        "..#......##.#...##.#.#......#.#\n" +
        "..........#.#....#.#..#....#...\n" +
        "##..##...##.......#.#....#.#.##\n" +
        ".##..#.#..#...........#.#...#.#\n" +
        "#......##......#....####.#....#\n" +
        "..###......##...#...#.#.......#\n" +
        ".#.##.##....##..#..##...#......\n" +
        ".#....#..#........#..#.##.#.#..\n" +
        "..#.........#.#.###....###.#...\n" +
        "..#..#.#.#..#..#.##.##...####..\n" +
        "#..#..#......#..#.#....#.#.#.##\n" +
        "..#.........#...#..#.#.#..#...#\n" +
        "#..#......###.....##....##.....\n" +
        "#..#.....#.#.#.##.....##...#.#.\n" +
        "##..#.#...#.........#.#........\n" +
        "#....#.......#.....#..#..#.#...\n" +
        "...###.##.###.###.#####..#...#.\n" +
        ".....#..#.#..##...............#\n" +
        "..#.....###.###.#.....#.#....##\n" +
        "###.#.........#..#.#.#..#.#..#.\n" +
        ".##.........#..#..##....#.#...#\n" +
        ".#...#........#...#.....#....#.\n" +
        "####..........###....#.#.#....#\n" +
        "....##..###....#....#.#...#....\n" +
        "..............##......##..#.###\n" +
        ".#...........###.#.#....#......\n" +
        "###.#..#..#...#.........##.....\n" +
        "..#.....##...#.#.....##...#.##.\n" +
        ".###.#........#..#.#...#.#..##.\n" +
        ".......##....##.........##.#..#\n" +
        "#....#...#...##...#.#..#..#..##\n" +
        "...#...##..#...#...#.#....#.#.#\n" +
        "#.#......#.#...##......#.#...##\n" +
        ".#.###..#.###.#.....#.##.##.#.#\n" +
        "#...#............#...#.##..##..\n" +
        "....#..###.......#.....##....#.\n" +
        ".#####..#.....#.....#...#.....#\n" +
        "..##..#..###.......##.#........\n" +
        ".#...##.##.....#.##...##...#..#\n" +
        "......###...#....#....#........\n" +
        "....#...#.#....#...#.#.#......#\n" +
        "....#..##...##.#..#....###.....\n" +
        "...#...#..#.#...#....#.#..#####\n" +
        "####....#.....#.........#.#....\n" +
        "...###.#.#..#.#..##............\n" +
        ".##..#####..#...#..#..#.......#\n" +
        ".###......#.#.#..#....#.....#..\n" +
        "#....##.##..#.#...............#\n" +
        "...#.#..#........#......#....#.\n" +
        "#.....#....###....#..#.#.#.....\n" +
        ".#..#....#...#.#.....##....#...\n" +
        "..#.##.#.##.#..#.##.#.....#.#..\n" +
        ".......#.......###..###..#...#.\n" +
        ".#.......#..#........#.#.......\n" +
        ".#.#...#.....#.##..##.....#....\n" +
        "#.......##....#......#.....##..\n" +
        ".#.....#...##...#..##.....#....\n" +
        "....#..#.#.......#.#.#.........\n" +
        "..#....#....##.##..#..##.##.#..\n" +
        ".#...#....##...#........#....#.\n" +
        "#.#......#...#....#...........#\n" +
        ".#....#..#..###.#.....#..#.....\n" +
        "..#..................#.....#...\n" +
        "..#...###..#..####.#..#.#.#.#..\n" +
        "...#........##...##..##..#....#\n" +
        "...#.....#........##..#.....#.#\n" +
        "#....#.....##.##......#...##...\n" +
        "...#####....#..##..##...#.#....\n" +
        "###.........#.#..#..#..##.#...#\n" +
        "##...#..##...#.##.#........#...\n" +
        ".#....#.#...#..#...#..#.#......\n" +
        ".#......##.#...#...#..#....#...\n" +
        "#..#.#.#......##.##.####..#....\n" +
        ".#...#.#.##...##.#...#...#.....\n" +
        "####.#.........#...##..##....##\n" +
        ".....###........###.##...#.#...\n" +
        ".##.....#.....#....##.....##...\n" +
        ".#.#...#####....##...##.....#..\n" +
        "....###..........#......##..#.#\n" +
        "..#.....#....#..#...#.....##..#\n" +
        "...##.##.#.######....#.#....##.\n" +
        "...#.#.#...#..#....##.........#\n" +
        ".#.#...##...#....#.#....##.....\n" +
        "...#..#.....#.....#.##.....#...\n" +
        ".#.#.#.....#.##.#....#.#....##.\n" +
        "#...#......###...#..###...#....\n" +
        "...##.#.#..#........##.......#.\n" +
        ".####.####......#........#.....\n" +
        "....#..#####....#......####....\n" +
        "#...##.#..#..#####.#...#......#\n" +
        "#.#....#..#.........###........\n" +
        ".##.........#....#......#.#....\n" +
        "...###.........####.#........##\n" +
        "..#..#........#.#..##......#..#\n" +
        ".##..#....#...##.####.#...#....\n" +
        "......#.......#..#..#.#.##.#...\n" +
        ".###....#.#...#.#.......##..#.#\n" +
        "#...#....#............#####....\n" +
        "...#.##......#####..#........#.\n" +
        "..#...##.....#...#..#.#........\n" +
        "...#.#...#...##...#..#....#....\n" +
        "..#..##.....#....#.#.###.......\n" +
        ".......##..#...#.............##\n" +
        ".....#.....#..##.##.....#......\n" +
        ".....##...#......#..##....#.###\n" +
        ".#...#.#.#.#.##.....##..###..#.\n" +
        "....##..........#.....###......\n" +
        "....#...#.#.#..#.......#....#..\n" +
        "..###...#...........##..###....\n" +
        "...#.##.......#....#....#.#....\n" +
        "##...#..##..#.##..........##..#\n" +
        ".##.....#..#......##..####.#.##\n" +
        "....##..#.#.###......#..#...#..\n" +
        "####..#.#....#...#....###.#.#..\n" +
        "###......#...##.##..#.##..#..#.\n" +
        "..#.#..#.#.#.....#...#..#.####.\n" +
        ".###.#...##...##....##......#.#\n" +
        "..#............#.##..#....#..#.\n" +
        "###.......#......###..#........\n" +
        "....##......###.....#.#..###...\n" +
        "..#...##...#......#..#.........\n" +
        "#..####.#....#.....###....#.#..\n" +
        ".#.#.#.......##....###.........\n" +
        ".......#.##.#####....#.#...####\n" +
        ".#...#....#....#.###..#.....#..\n" +
        ".###.#.#.###.###.#..####.##.#..\n" +
        "....#.........#.#.......##.....\n" +
        "#..#..#.#...........#.#.##..#.#\n" +
        ".#.....#..#...#.....#.##......#\n" +
        "..###.#............#.....####..\n" +
        "#.....##..##...#....####....#..\n" +
        "...#.....#..................#..\n" +
        "....#.###.#..#..#..##..#..##...\n" +
        "...##.#........#......#...##...\n" +
        "#................##....#...#...\n" +
        "..##......##.#.##..#....#.....#\n" +
        ".#..#.....#..........##.#.#....\n" +
        ".....#...####....#..#......#...\n" +
        "..#......###.#.#.#.#.......#..#\n" +
        ".##......#.......#....###.#....\n" +
        "#..#.#.#..#...#.#.##..##..#....\n" +
        "....#...##..#.#......#.##...#..\n" +
        "...###...#.##..#...#....#......\n" +
        "##......#.#...#.#.#.........#..\n" +
        "..#..........#...###.#.##....#.\n" +
        "...##.....#.....#...###..#.....\n" +
        "..####.#.....#.#.....#..#.#....\n" +
        ".#.....##...##.##.#.....#.####.\n" +
        ".......#.....#...##..........#.\n" +
        ".#...#.#....#####....###.#..#.#\n" +
        ".##.##....##...##.#.....#......\n" +
        "#......#.##..#..##.#.#.......#.\n" +
        ".#..#....###..#........##...#..\n" +
        "..#......##.......###..##...#..\n" +
        ".#..........#.#.......##.....#.\n" +
        "....##.....##.#.#.##........##.\n" +
        "..#.#..###..#..##...#.##...#...\n" +
        ".......#.....#..#...#...#.....#\n" +
        "##.#...#.#.#.##........#......#\n" +
        "..###.....##..#....#.......##..\n" +
        "#####..####...#.#..##.#...#..#.\n" +
        "#...####....#........#....#....\n" +
        ".#.#.#..#...##....#.......#.#..\n" +
        "...#....##..##..#..#..#####.###\n" +
        "...#......#.#..#......#...####.\n" +
        ".##.....##.##.#.####.#..##...#.\n" +
        "....#..#..##..##....#....#...##\n" +
        "##.###........#...##....#.....#\n" +
        "..#.#.#.......#....#..#....#...\n" +
        "......##.....##....#...#.....#.\n" +
        "#.#..#.#.......#....#.#.#......\n" +
        ".....###..#...#.....#..##..#...\n" +
        "......###.....#.#.#...#...##..#\n" +
        ".#..#.#....##...#...#........#.\n" +
        "#..###.#...####.#...#..........\n" +
        ".#.##.#..#..##..#..###..##...#.\n" +
        ".......#.#..........#.........#\n" +
        "#......###..##..#....###.......\n" +
        "..#............#.#........#...#\n" +
        "..##.#.............#......#..##\n" +
        ".#....#..#.#..#....###..#...#..\n" +
        "....##....#..##...###....#....#\n" +
        ".#....###.............#........\n" +
        "#..#...#..#....#.##.#.....##...\n" +
        "...........#.....#....#....#...\n" +
        ".##.##.#...#....##......##..##.\n" +
        "......#.#.##.#..##........#...#\n" +
        "....##...##...#...#...#.#......\n" +
        ".#...#....#...#......#.#...#..#\n" +
        "........##.....#.#..#...##..##.\n" +
        "##...#.....#.....####...#..#...\n" +
        ".#.#..##.##......#...#.#...#...\n" +
        "##...##.#......#....#.######.#.\n" +
        "##.....####.###......#.##.#....\n" +
        ".#.##....##........#...#..####.\n" +
        ".......#..#....##...#.#...#..#.\n" +
        "...##..........#..#........#..#\n" +
        ".##.....#...#...#.##.###.......\n" +
        ".##....#...#.#..#.....#...#....\n" +
        "..#...#.....#.####.#.........#.\n" +
        "#...#.##...#.#..#.#..#.###.#..#\n" +
        ".##..#.#.##.........####....###\n" +
        ".#..##........#..#.......#.....\n" +
        "......#.#####.#.........#.#...#\n" +
        "......#....#.#####...........#.\n" +
        "..##....##..#.#..#....#......##\n" +
        "#.#......#.##.#.##....#....#.#.\n" +
        "..#..##.#...#.......##.........\n" +
        ".....##.#...#..........#.......\n" +
        "...#........#..#...#.....##.###\n" +
        "....##.........#...#.#.....#...\n" +
        ".......#.#....#...#.......#...#\n" +
        ".#..#...##....#..#...........#.\n" +
        ".#....##.##.#..#..####.#.#.....\n" +
        ".##........#.....#..#......##..\n" +
        ".#..##......#......#..##..#....\n" +
        "###.....##.......#..##.#.......\n" +
        ".....##......#.#...##...##.....\n" +
        ".##....##..#..#####...#...#.##.\n" +
        "##...##.#....##.#.#.#....##....\n" +
        ".#.....#...#......#......##....\n" +
        "##.#............#...#....#.....\n" +
        "#..#.....#.....##.##.##..#..##.\n" +
        "......#..............#..#...#.#\n" +
        "....#.#....##......#..#...#....\n" +
        ".#...#..#...#......#..##....#.#\n" +
        ".....#......#..##...#.#....#...\n" +
        "#...............#.##..#......#.\n" +
        ".....#..##.#..#.#...###.....#..\n" +
        "...#..#..#...#....#..#..##.#...\n" +
        ".#...#...#..#......##...#......\n" +
        "....###............#.#.#....#..\n" +
        "#.#...#..#..#.#....#........#..\n" +
        "....#.#.#..#..#....#..#...##.#.\n" +
        ".#....#.#...#....#......#.#...#\n" +
        "##..#.#.#..#.....#...###....#.#\n" +
        ".##.....#.#...#..........#..#.#\n" +
        "#....#......#....#.#.#...#.....\n" +
        "#.#.....#.###.......#..#..#.#..\n" +
        "#.....##..#.###...#...##...#.##\n" +
        ".#.##....#.#.....##......###...\n" +
        ".#.......##................#...\n" +
        ".........#........####......#..\n" +
        "...##.###..#.....#.#.....##.#..\n" +
        "..#....#.#.#.##..........#.....\n" +
        "#..##.....#.............##.....\n" +
        ".##...#..#.......#.......#..#..\n" +
        "...#.................#......##.\n" +
        "....#....#.....#..###.#....###.\n" +
        "..#.#..#...#..#.....###....#.#.\n" +
        ".....###...#....#....#.#.##..##\n" +
        "...#...#.........####........#.\n" +
        ".......#..##.........#.........\n" +
        ".#......##.....#.#####...##....\n" +
        "....#.###...#.#....##..#......#\n" +
        ".##..#....#.#....#..#.###.....#\n" +
        "..#...#.#...#.##.....#.#....##.\n" +
        "#.#.#.#.....##...#.#..##..#....\n" +
        ".#............#.#.#..#...#...#.\n" +
        "...##.#..#..####.#.###..##.....\n" +
        ".##.....#.......#..##.#...##.#.\n" +
        "#.#...#..#.##...##...####..#..#\n" +
        "...##.......#.#.#.#.#.#...#..##\n" +
        "...#.#.##..##..............###.\n" +
        ".....#...#........#...#......#.\n" +
        "..#..#..##....#..##.#.....#....\n" +
        "#.....##........#.........##.#.\n" +
        "###..#....#.##..##.............\n" +
        ".#..#...#.#......#..#..##.....#\n" +
        "...#.#.#............##........#\n" +
        "..#.#....#..#....##....#...##.#\n" +
        "...##...#...#..........##.#####\n" +
        "....#..#.#.......##....#.#.###.\n" +
        "##..#..#..#...###.#.....#......\n" +
        "....###.#.#.#.##..##.#...#.....\n" +
        ".....####..#.#..#.#......#.#.#.\n" +
        "#.....#...#..#.#.........#..#..\n" +
        ".##....#.#.####......##..#..##.\n" +
        "......#.##.#.#..#..#....#.#....\n" +
        ".#..#...#...#...#..#.....#.....\n" +
        "..##.#..............#......#...\n" +
        ".....###.##.......#.....#..#...\n" +
        "..#.#..#..#.......#...##.##..#.\n" +
        "##.###......#......#.#..#..##..\n" +
        "..##.....#..#..#......#..#.....\n" +
        "...##.......#.#..#.........#.#.\n" +
        "......##.##.#.......#..#.#.....\n" +
        "#......#........##..#.......#.#\n" +
        "###....#...#...#.#...#..#..#...\n" +
        "#..###....#....####..#...#.....\n" +
        "....##..#.##.#....#..##...#.#..\n" +
        "#.##..#....##..#...#..#.#.#..#.\n" +
        "#.........#.....#...#.......#..\n" +
        "...#.....#.#.....#........##...\n" +
        "..#.##..#......#...#.....##.#..\n" +
        "...###....#.....#...#..#.##..#."
}
